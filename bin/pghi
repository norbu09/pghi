#!/usr/bin/perl

use 5.10.0;
use Net::GitHub;
use Data::Dumper;

my $tag = shift || 'critical';

my $github = login();
my $issues =
  $github->issue->repos_issues( 'ideegeo', 'iwmn-base',
    { labels => $tag, state => 'open', sort => 'updated_at' } );
print "## open issues [$tag] ##\n\n";
foreach my $issue (@{$issues}){
    print $issue->{title} ."\n";
    print "--------------\n";
    print $issue->{body};
    print "\n".$issue->{user}->{login}.":[".$issue->{created_at}."]\n";
    print "###############\n\n";

}
#print Dumper($issues);

sub login {
    my $login = `git config --global github.user`;
    my $pass = `git config --global github.pass`;
    chomp($login);
    chomp($pass);
    unless ( $login and $pass ) {
        print "run git config --global github.user|pass fails";
        return;
    }
    my $gh = Net::GitHub->new(
        login => $login,
        pass  => $pass,
        #access_token => '31359f2ae3804e5afdcf7fc34e2089fc',
        version => 3,
    );
    return $gh;
}

